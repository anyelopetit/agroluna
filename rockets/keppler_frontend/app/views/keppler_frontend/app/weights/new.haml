
%script{src: "/assets/keppler_frontend/app/jquery.min.js"}
-# = render 'keppler_frontend/app/farms/components/navbar', farm: @farm, farms: @farms
.app_wrapper
  .container_carousel
    .single-item
      - unless @cow.weight.blank?
        = link_to({controller: :cattle, action: :index}, { class: 'mt-4 mb-4 ml-3' }) do
          %button.btn.btn_custom.btn--medium
            %i.icofont-circled-left
            Listado
      .row
        .col-lg-9.col-md-8.col-sm-12
          .card_new
            %h1 
              Crear status inicial 
              %span.ml-3{style: "color:#797979 !important;"} (#{@cow.serie_number})
            = simple_form_for [@farm, @cow, @weight] do |f|
              .form-padding
                .row
                  = f.input :user_id, include_blank: false, input_html: { class: 'form-control input_custom', value: current_user.id }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  = f.input :cow_id, include_blank: false, input_html: { class: 'form-control input_custom', value: @cow.id }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :weight, autofocus: true, placeholder: '0.00 KG', label: 'Peso (KG)', input_html: { class: 'form-control input_custom', min: 0, value: (@last_weight&.weight.blank? ? 0 : @last_weight&.weight) }, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :gained_weight, input_html: { class: 'form-control input_custom weight_gainded_weight' }, disabled: true, placeholder: '0.00 KG', label: 'Peso ganado (KG)', label_html: { class: 'label_custom--strong' }
                    = f.input :gained_weight, input_html: { class: 'form-control input_custom weight_gainded_weight' }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :average_weight, input_html: { class: 'form-control input_custom weight_average_weight' }, disabled: true, placeholder: '0.00 KG', label: 'Peso promedio (KG)', label_html: { class: 'label_custom--strong' }
                    = f.input :average_weight, input_html: { class: 'form-control input_custom weight_average_weight' }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :corporal_condition_id, collection: @corporal_conditions, selected: (@last_weight&.corporal_condition if @last_status), include_blank: false, label: 'Condición corporal', label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  -# .col-sm-12.col-md-4
                    = f.input :years, label: 'Años', input_html: { class: 'form-control input_custom  status_years', value: @cow.years }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :years, input_html: { class: 'form-control input_custom status_years', value: @cow.years }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-4
                    = f.input :months, label: 'Meses', input_html: { class: 'form-control input_custom  status_months', value: @cow.months }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :months, input_html: { class: 'form-control input_custom  status_months', value: @cow.months }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-4
                    = f.input :days, label: 'Días de nacido', input_html: { class: 'form-control input_custom status_days', value: @cow.days }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :days, input_html: { class: 'form-control input_custom  status_days', value: @cow.days }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-6
                    = f.input :farm_id, input_html: { class: 'form-control input_custom', value: @farm&.id }, as: :hidden # collection: @farms, selected: @farm, include_blank: false, label: 'Finca', label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-6
                    = f.input :strategic_lot_id, input_html: { class: 'form-control input_custom', value: (@strategic_lot.id if @strategic_lot) }, as: :hidden#, collection: @strategic_lots, input_html: { class: 'form-control input_custom', min: 0, value: (@last_location&.strategic_lot_id if @last_status) }, label: 'Lote estratégico', label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-4
                    = f.input :ubication, collection: @ubications, selected: (@last_status.ubication if @last_status), label: 'Ubicación', label_html: { class: 'label_custom--strong' }
                  -# - if @cow.gender?('male')
                    - [[:reproductive, 'Reproductor'], [:defiant, 'Recelador']].each do |attribute|
                      .col-xs-6.col-sm-6.col-md-3
                        .keppler-custom-field.form-group.keppler_boolean.optional{ class: "status-#{attribute.first.to_s}"}
                          %label.control-label.keppler_boolean.optional{for: "status_#{attribute.first.to_s}"}= attribute.last.humanize
                          %label.keppler-switch
                            %input{ class: ('active' if @last_status.try(attribute.first)), id: "status_#{attribute.first.to_s}", checked: '', name: "status[#{attribute.first}]", tabindex: "0", type: "checkbox", value: (@last_status.try(attribute.first) ? 'true' : 'false')}
                            %span.slider.round
                    -# .col-xs-6.col-sm-6.col-md-3
                    -#   = f.input :reproductive, input_html: { class: 'form-control input_custom', value: (@last_status.reproductive if @last_status) }, as: :keppler_boolean, label: 'Reproductivo', label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-3
                    -#   = f.input :defiant, as: :keppler_boolean, label: 'Recelador', input_html: { class: 'form-control input_custom', value: (@last_status.defiant if @last_status) }, value: (@last_status.defiant if @last_status), label_html: { class: 'label_custom--strong' }
                  -# - if @cow.gender?('female')
                    - [[:pregnant, 'Preñada'], [:lactating, 'Lactando'], [:breeding, 'Criando']].each do |attribute|
                      .col-xs-6.col-sm-6.col-md-2
                        .keppler-custom-field.form-group.keppler_boolean.optional{ class: "status-#{attribute.first.to_s}"}
                          %label.control-label.keppler_boolean.optional{for: "status_#{attribute.first.to_s}"}= attribute.last.humanize
                          %label.keppler-switch
                            %input{ class: ('active' if @last_status.try(attribute.first)), id: "status_#{attribute.first.to_s}", checked: '', name: "status[#{attribute.first}]", tabindex: "0", type: "checkbox", value: (@last_status.try(attribute.first) ? 'true' : 'false')}
                            %span.slider.round
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :pregnant, as: :keppler_boolean, label: 'Preñada', input_html: { class: 'form-control input_custom', value: (@last_status.pregnant if @last_status) }, label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :lactating, as: :keppler_boolean, label: 'Lactando', input_html: { class: 'form-control input_custom', value: (@last_status.lactating if @last_status) }, label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :breeding, as: :keppler_boolean, label: 'Criando', input_html: { class: 'form-control input_custom', value: (@last_status.breeding if @last_status) }, label_html: { class: 'label_custom--strong' }
                  -# .col-xs-6.col-sm-6.col-md-2
                    = f.input :dead, as: :keppler_boolean, label: 'Dar de baja', input_html: { class: 'form-control input_custom', value: (@last_status.dead if @last_status) }, label_html: { class: 'label_custom--strong' }
                  -# .col-xs-6.col-sm-6.col-md-4
                    = f.input :deathdate, as: :string, input_html: { class: 'form-control input_custom  datepicker', disabled: true }, label: 'Fecha de muerte', label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-6
                    = f.input :corporal_condition, collection: @corporal_conditions, selected: (@last_weight&.corporal_condition if @last_status), include_blank: false, label: 'Condición corporal', label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  -# .col-sm-12.col-md-6
                    = f.input :typology_id, collection: @typologies, include_blank: false, label: 'Tipología', selected: (@last_typology if @last_status), label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  -# .col-sm-12.col-md-6
                    = f.input :user_id, input_html: { class: 'form-control input_custom', value: (current_user.id if current_user) }, as: :hidden#, label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12
                    = f.input :observations, label: 'Observaciones', label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12
                    .float-right
                      %button.btn.btn_custom.btn--filled.btn--medium{ type: 'submit' }
                        %i.icofont-save
                        Guardar
        .col-lg-3.col-md-4.col-sm-12
          .card_new
            .float-right
              -# = image_tag "/assets/keppler_cattle/#{@cow.species}", class: 'svg-icon-md p-absolute r-0' unless @cow.species.blank?
              = image_tag "/assets/keppler_cattle/#{@cow.gender}", class: 'svg-icon-md p-absolute r-0' unless @cow.gender.blank?
            .row
              .col-sm-12{ :style =>"display: flex; justify-content: center;"}
                .card_cow
                  %center.row
                    .col-lg-12
                      = image_tag (@cow.image&.url || (@cow.gender?('male') ? 'https://image.flaticon.com/icons/svg/1495/1495074.svg' : 'https://image.flaticon.com/icons/svg/523/523448.svg')), class: 'avatar_cow'
                    .col-lg-12
                      .card_cow_content{ :style => "text-align: center;"}
                        %h2= @cow.serie_number
                        %small= "(#{@cow.short_name})" unless @cow.short_name.blank?
                        %strong
                          = @cow.typology_name unless @cow.typology&.blank?
                        %span= @cow.race&.name
                        -# %p= @cow.observations.col-lg-4.col-md-6
                    .col-lg-12.mt-5
                      .row
                        .col-lg-12
                          %dl
                            %dt.card_status_details Años - Meses
                            %dd.card_status_details #{@cow.years} - #{@cow.months}
                        .col-lg-12
                          %dl
                            %dt.card_status_details Fecha de Nacimiento
                            %dd.card_status_details= @cow.birthdate
                
                        .col-lg-12
                          %dl
                            %dt.card_status_details
                              Días de nacido
                            %dd.card_status_details= @cow.days

// Plugins
%link{href: "https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css", rel: "stylesheet"}/
%script{src: "https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"}

:javascript
  $('.keppler-switch').click(function(event) {
    event.preventDefault()
    var input = $(this).find('input')
    var label = $(this).find('.inline-label')
    input
      .toggleClass('active')
      .val(input.hasClass('active'))
    label
      .toggleClass('active')
      //.text(label.hasClass('active'))
  })
-# :javascript
  $('.status_dead').click(function() {
    if ($(this).find('.inline-label').hasClass('active')) {
      document.getElementById('status_deathdate').disabled = false
    } else {
      document.getElementById('status_deathdate').disabled = true
      document.getElementById('status_deathdate').value = ""
    }
  })
-# :javascript
  function noImageSelect (option) {
    var optionTxt = option.text
    if (!option.id) return optionTxt;
    var $option = $(
      '<span class="cattle-option">' +
        optionTxt +
      '</span>'
    );
    return $option;
  };

  $('#status_typology').select2({
    placeholder: "Elige una tipología",
    templateResult: noImageSelect,
    templateSelection: noImageSelect
  });
:javascript
  var last_weight = #{@cow.weight&.weight ? @cow.weight&.weight : 0}
  var born_days = #{@cow.days}

  $(document).ready(function() {
    $('.weight_gained_weight').val(
       $('#weight_weight').val() - last_weight
    )
    $('.weight_average_weight').val(
      ($('#weight_weight').val() - last_weight) / born_days 
    )
  })

  $('#weight_weight').keyup(function() {
    $('.weight_gained_weight').val(
       $('#weight_weight').val() - last_weight
    )
    $('.weight_average_weight').val(
      ($('#weight_weight').val() - last_weight) / born_days
    )
  }) 