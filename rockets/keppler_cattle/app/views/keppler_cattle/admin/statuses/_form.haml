= simple_form_for [:admin, :cattle, @cow, @status] do |f|
  .container
    .row
      .col-lg-2
        = link_to edit_admin_cattle_cow_path(@cow), 'data-position': 'bottom', 'data-tooltip': t('keppler.actions.back') do
          .arrow-back.btn.btn-default
            %i.fa.fa-angle-left
            = t('keppler.actions.back')

    .row
      .col-lg-8
        .box.slice-box
          .box-header.with-border
            %h3.box-title= t('keppler.models.pluralize.statuses').humanize
            .box-tools.pull-right
              %a.btn.btn-box-tool{'data-widget': 'collapse', type: 'button'}
                %i.fa.fa-minus
          .box-body
            %table.table.table-bordered
              %tbody
                .form-padding
                  = f.input :cow_id, include_blank: false, input_html: { class: 'form-control input_custom', value: @cow.id }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :weight, autofocus: true, placeholder: '0.00 KG', label: 'Peso (KG)', input_html: { class: 'form-control input_custom', min: 0, value: (@last_status.weight if @last_status) }, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :gained_weight, input_html: { class: 'form-control input_custom   status_gainded_weight' }, disabled: true, placeholder: '0.00 KG', label: 'Peso ganado (KG)', label_html: { class: 'label_custom--strong' }
                    = f.input :gained_weight, input_html: { class: 'form-control input_custom   status_gainded_weight' }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-4
                    = f.input :years, label: 'Años', input_html: { class: 'form-control input_custom  status_years', value: @cow.years }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :years, input_html: { class: 'form-control input_custom   status_years', value: @cow.years }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-4
                    = f.input :months, label: 'Meses', input_html: { class: 'form-control input_custom  status_months', value: @cow.months }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :months, input_html: { class: 'form-control input_custom  status_months', value: @cow.months }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-4
                    = f.input :days, label: 'Días de nacido', input_html: { class: 'form-control input_custom   status_days', value: @cow.days }, disabled: true, label_html: { class: 'label_custom--strong' }
                    = f.input :days, input_html: { class: 'form-control input_custom  status_days', value: @cow.days }, as: :hidden, label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :farm_id, input_html: { class: 'form-control input_custom' }, collection: @farms, selected: @farm, include_blank: false, label: 'Finca', label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :strategic_lot_id, input_html: { class: 'form-control input_custom', selected: (@strategic_lot.id if @strategic_lot) }, collection: @strategic_lots, input_html: { class: 'form-control input_custom', min: 0, value: (@last_status.strategic_lot_id if @last_status) }, label: 'Lote estratégico', label_html: { class: 'label_custom--strong' }
                  -# .col-sm-12.col-md-4
                    = f.input :ubication, collection: @ubications, selected: (@last_status.ubication if @last_status), label: 'Ubicación', label_html: { class: 'label_custom--strong' }
                  - if @cow.gender?('male')
                    - [[:reproductive, 'Reproductor'], [:defiant, 'Recelador']].each do |attribute|
                      .col-xs-6.col-sm-6.col-md-3
                        .keppler-custom-field.form-group.keppler_boolean.optional{ class: "status-#{attribute.first.to_s}"}
                          %label.control-label.keppler_boolean.optional{for: "status_#{attribute.first.to_s}"}= attribute.last.humanize
                          %label.keppler-switch
                            %input{ class: ('active' if @last_status.try(attribute.first)), id: "status_#{attribute.first.to_s}", checked: '', name: "status[#{attribute.first}]", tabindex: "0", type: "checkbox", value: (@last_status.try(attribute.first) ? 'true' : 'false')}
                            %span.slider.round
                    -# .col-xs-6.col-sm-6.col-md-3
                    -#   = f.input :reproductive, input_html: { class: 'form-control input_custom', value: (@last_status.reproductive if @last_status) }, as: :keppler_boolean, label: 'Reproductivo', label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-3
                    -#   = f.input :defiant, as: :keppler_boolean, label: 'Recelador', input_html: { class: 'form-control input_custom', value: (@last_status.defiant if @last_status) }, value: (@last_status.defiant if @last_status), label_html: { class: 'label_custom--strong' }
                  - if @cow.gender?('female')
                    - [[:pregnant, 'Preñada'], [:lactating, 'Lactando'], [:breeding, 'Criando']].each do |attribute|
                      .col-xs-6.col-sm-6.col-md-2
                        .keppler-custom-field.form-group.keppler_boolean.optional{ class: "status-#{attribute.first.to_s}"}
                          %label.control-label.keppler_boolean.optional{for: "status_#{attribute.first.to_s}"}= attribute.last.humanize
                          %label.keppler-switch
                            %input{ class: ('active' if @last_status.try(attribute.first)), id: "status_#{attribute.first.to_s}", checked: '', name: "status[#{attribute.first}]", tabindex: "0", type: "checkbox", value: (@last_status.try(attribute.first) ? 'true' : 'false')}
                            %span.slider.round
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :pregnant, as: :keppler_boolean, label: 'Preñada', input_html: { class: 'form-control input_custom', value: (@last_status.pregnant if @last_status) }, label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :lactating, as: :keppler_boolean, label: 'Lactando', input_html: { class: 'form-control input_custom', value: (@last_status.lactating if @last_status) }, label_html: { class: 'label_custom--strong' }
                    -# .col-xs-6.col-sm-6.col-md-2
                    -#   = f.input :breeding, as: :keppler_boolean, label: 'Criando', input_html: { class: 'form-control input_custom', value: (@last_status.breeding if @last_status) }, label_html: { class: 'label_custom--strong' }
                  .col-xs-6.col-sm-6.col-md-2
                    = f.input :dead, as: :keppler_boolean, label: 'Dar de baja', input_html: { class: 'form-control input_custom', value: (@last_status.dead if @last_status) }, label_html: { class: 'label_custom--strong' }
                  .col-xs-6.col-sm-6.col-md-4
                    = f.input :deathdate, as: :string, input_html: { class: 'form-control input_custom  datepicker', disabled: true }, label: 'Fecha de muerte', label_html: { class: 'label_custom--strong' }
                  .col-sm-12.col-md-6
                    = f.input :corporal_condition, collection: @corporal_conditions, selected: (@last_status.corporal_condition if @last_status), include_blank: false, label: 'Condición corporal', label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12.col-md-6
                    = f.input :typology, collection: @typologies, include_blank: false, label: 'Tipología', selected: (@last_status.typology if @last_status), label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12.col-md-6
                    = f.input :user_id, input_html: { class: 'form-control input_custom', value: (current_user.id if current_user) }, as: :hidden#, label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12
                    = f.input :comments, label: 'Observaciones', label_html: { class: 'label_custom--strong' }, input_html: { class: 'form-control input_custom' }
                  .col-sm-12
                    .pull-right
                      = f.button :submit, t('keppler.actions.save'), name: '_save', class: 'btn-primary'
                      -# = f.button :submit, t('keppler.actions.save_and_add_another'), name: '_add_other'
      .col-lg-4
        .box.slice-box
          .box-header.with-border
            = !@cow.serie_number.blank? ? @cow.serie_number : t('keppler.models.singularize.cow').humanize
          .box-body.no-padding
            %table.table
              %tbody
                %tr.list-row
                  %th.display-label= t("activerecord.attributes.image").humanize
                  %td.display-value.fs-body-1.tc-black-2
                    %center
                      = image_tag @cow.image&.url || '/assets/keppler_cattle/cow_shadow', style: 'max-width: 100%;'
                      %h5= "SIN FOTO" if @cow.image&.url.blank?
                - @cow.as_json(except: %w[image position deleted_at]).each do |attribute, value|
                  %tr.list-row
                    %th.display-label= t("activerecord.attributes.#{attribute}").humanize
                    %td.display-value.fs-body-1.tc-black-2
                      - if @attachments.dig('images', 'names').include?(attribute)
                        = image_tag value.url if value.url
                      - elsif @attachments.dig('images', 'names').map(&:pluralize).include?(attribute)
                        - value.each do |image|
                          = image_tag image.url if image.url
                      - else 
                        = sanitize raw value

:javascript
  $('#status_ubication').select2({
    tags: true,
    placeholder: "Selecciona o escribe una ubicación",
  });

  $('#status_farm_id').select2({
    placeholder: "Selecciona una finca",
  });

  $('#status_strategic_lot_id').select2({
    placeholder: "Selecciona un lote estratégico",
  });

  $('.status_dead').click(function() {
    if ($(this).find('.inline-label').hasClass('active')) {
      document.getElementById('status_deathdate').disabled = false
    } else {
      document.getElementById('status_deathdate').disabled = true
      document.getElementById('status_deathdate').value = ""
    }
  })
  
  function noImageSelect (option) {
    var optionTxt = option.text
    if (!option.id) return optionTxt;
    var $option = $(
      '<span class="cattle-option">' +
        optionTxt +
      '</span>'
    );
    return $option;
  };

  $('#status_typology').select2({
    placeholder: "Elige una tipología",
    templateResult: noImageSelect,
    templateSelection: noImageSelect
  });
  
  var last_weight = #{@cow.status ? @cow.status.weight : 0}

  $(document).ready(function() {
    $('.status_gainded_weight').val(
       $('#status_weight').val() - last_weight
    )
  })

  $('#status_weight').keyup(function() {
    $('.status_gainded_weight').val(
       $('#status_weight').val() - last_weight
    )
  }) 